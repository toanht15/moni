(function(){window.Synapse={endpoint:"https://api.synapse-link.com",ad:{endpoint:"https://ssl.socdm.com"},version:"1.1.0"},document.addEventListener("DOMContentLoaded",function(a){return Array.prototype.forEach.call(document.querySelectorAll(".synapse-page-tracker"),function(a){return Synapse.Page.initializeWithHTMLElement(a)})})}).call(this),function(){Synapse.Logger=function(){function a(){}return a.DEBUG=0,a.INFO=1,a.WARN=2,a.ERROR=3,a.logLevel=3,a.debug=function(a){return this.logLevel<=this.DEBUG?console.log("%c"+a,"color: #808080"):void 0},a.info=function(a){return this.logLevel<=this.INFO?console.info("%c"+a,"color: #0000CD"):void 0},a.warn=function(a){return this.logLevel<=this.WARN?console.warn("%c"+a,"color: #FF8C00"):void 0},a.error=function(a){return this.logLevel<=this.ERROR?console.error("%c"+a,"color: red; font-style: italic"):void 0},a}()}.call(this),function(){Synapse.EventListener=function(){function a(a){this.handler=a}return a.prototype.className="Synapse.EventListener",a}()}.call(this),function(){var a=[].slice;Synapse.MVCObject=function(){function b(){}return b.prototype.className="Synapse.MVCObject",b.prototype.addListener=function(a,b){var c;return this._listeners||(this._listeners={}),c=new Synapse.EventListener(b),"undefined"==typeof this._listeners[a]?this._listeners[a]=[c]:this._listeners[a].push(c),c},b.prototype.fire=function(){var b,c;return c=arguments[0],b=2<=arguments.length?a.call(arguments,1):[],this._listeners||(this._listeners={}),"object"==typeof this._listeners[c]?this._listeners[c].forEach(function(a){return a.handler.apply(self,b)}):void 0},b.prototype.removeListener=function(a,b){var c;return this._listeners||(this._listeners={}),"object"==typeof this._listeners[a]?(c=this._listeners[a].indexOf(b),this._listeners[a].splice(c,1)):void 0},b}()}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;Synapse.APIResponse=function(c){function d(){this.setResponseObject=a(this.setResponseObject,this),this.setHeaders=a(this.setHeaders,this),this.updateWithXHRObject=a(this.updateWithXHRObject,this)}return b(d,c),d.prototype.className="Synapse.APIResponse",d.prototype.status=null,d.prototype.headers={},d.prototype.responseObject=null,d.prototype.responseText=null,d.prototype.isSuccess=!1,d.prototype.updateWithXHRObject=function(a){var b;return this.status=a.status,this.setHeaders(a.getAllResponseHeaders()),this.responseText=a.responseText,this.responseObject=this.setResponseObject(a.responseText),this.isSuccess=null!=(b=this.status>=200&&this.status<400)?b:{"true":!1},this.fire("update")},d.prototype.setHeaders=function(a){return a.split("\r\n").forEach(function(a){return function(b){var c;return c=b.split(":"),2===c.length?a.headers[c[0].trim()]=c[1].trim():void 0}}(this))},d.prototype.setResponseObject=function(a){try{return this.responseObject=JSON.parse(a)}catch(b){return this.responseObject=null}},d}(Synapse.MVCObject)}.call(this),function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;Synapse.APIClient=function(b){function c(a){null==a&&(a={}),this.endpoint=(a.endpoint||Synapse.endpoint).replace(/\/$/,""),this.serviceUUID=a.serviceUUID,this.useCookie=!0,Synapse.Logger.debug("Synapse.APIClient initialized.")}return a(c,b),c.prototype.className="Synapse.APIClient",c.prototype.STATE_INTIALIZED=0,c.prototype.STATE_LOADED=1,c.prototype.timeout=2e3,c.prototype.get=function(a,b){var c,d,e,f,g;null==b&&(b={}),b.synapse_js_sdk_version=Synapse.version,d=[];for(e in b)d.push(e+"="+encodeURIComponent(b[e]));return f=d.length>0?[""+this.endpoint+a,d.join("&")].join("?"):""+this.endpoint+a,g=new XMLHttpRequest,g.open("GET",f,!0),Synapse.Logger.debug("XHR GET Request: "+f),g.timeout=this.timeout,g.withCredentials=this.useCookie,g.send(),c=new Synapse.APIResponse,g.onreadystatechange=function(a){return function(){return g.readyState===XMLHttpRequest.DONE?c.updateWithXHRObject(g):void 0}}(this),g.ontimeout=function(a){return function(){return c.fire("timeout")}}(this),c},c}(Synapse.MVCObject)}.call(this),function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;Synapse.Menu=function(b){function c(a){this.menuName=a,this.status=Synapse.APIClient.prototype.STATE_INTIALIZED,this._apiClient=new Synapse.APIClient,this._eventSender=new Synapse.EventSender(this._apiClient)}return a(c,b),c.prototype.className="Synapse.Menu",c.prototype.init=function(){return this.serviceList=new Synapse.ServiceList(this),this.serviceList.addListener("load",function(a){return function(){return a.status=Synapse.APIClient.prototype.STATE_LOADED,a.serviceList.serviceListItems.forEach(function(b){return b._bindToServiceNotification(a.serviceNotification),b.addListener("notification_update",function(){return a.fire("service_notification_update")})}),a.fire("service_list_load"),a._fire_ready()}}(this)),this.serviceList.fetch(),this.serviceNotification=new Synapse.ServiceNotification(this),this.serviceNotification.addListener("load",function(a){return function(){return a.fire("service_notification_load")}}(this)),this.serviceNotification.fetch()},c.prototype._fire_ready=function(){return this.serviceList.status===Synapse.APIClient.prototype.STATE_LOADED?this.fire("ready"):void 0},c.prototype.trackShowEvent=function(){return this.serviceList._clearShowServiceList(),this._eventSender.send("show_menu",{menu_name:this.menuName})},c}(Synapse.MVCObject)}.call(this),function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;Synapse.ServiceList=function(b){function c(a){this.menu=a,this.status=Synapse.APIClient.prototype.STATE_INTIALIZED,this.serviceListItems=[],this._displayedItems={},Synapse.Logger.debug("Synapse.ServiceList initialized.")}return a(c,b),c.prototype.className="Synapse.ServiceList",c.prototype.fetch=function(){var a;return a=this.menu._apiClient.get("/api/v2/service_lists/show.json",{menu_name:this.menu.menuName}),a.addListener("update",function(b){return function(){return b.status=Synapse.APIClient.prototype.STATE_LOADED,b._extractResponseObject(a.responseObject),Synapse.Logger.debug("Done: load service list done."),b.fire("load")}}(this))},c.prototype._extractResponseObject=function(a){var b;return b=a.service_list_items,b?b.forEach(function(a){return function(b){var c;return c=new Synapse.ServiceListItem(a),c._extractResponseObject(b),a.serviceListItems.push(c)}}(this)):void 0},c.prototype._clearShowServiceList=function(){return this._displayedItems={}},c.prototype._isShowServiceItem=function(a){return this._displayedItems[a]},c.prototype._setShowServiceItem=function(a){return this._displayedItems[a]=!0},c}(Synapse.MVCObject)}.call(this),function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;Synapse.ServiceListItem=function(b){function c(a){this.serviceList=a,this._elements={},this._elements.container=document.createElement("div"),this._elements.container.className="synapse_container",this._elements.anchor=document.createElement("a"),this._elements.container.appendChild(this._elements.anchor),this._elements.icon=document.createElement("img"),this._elements.icon.className="synapse_icon",this._elements.anchor.appendChild(this._elements.icon),this._elements.category=document.createElement("div"),this._elements.category.className="synapse_category",this._elements.categoryText=document.createTextNode(""),this._elements.category.appendChild(this._elements.categoryText),this._elements.anchor.appendChild(this._elements.category),this._elements.serviceName=document.createElement("div"),this._elements.serviceName.className="synapse_service_name",this._elements.serviceNameText=document.createTextNode(""),this._elements.serviceName.appendChild(this._elements.serviceNameText),this._elements.anchor.appendChild(this._elements.serviceName),this._elements.notificationCount=document.createElement("div"),this._elements.notificationCount.className="synapse_notification_count",this._elements.notificationCountText=document.createTextNode(""),this._elements.notificationCount.appendChild(this._elements.notificationCountText),this._elements.anchor.appendChild(this._elements.notificationCount),this._elements.notificationBody=document.createElement("div"),this._elements.notificationBody.className="synapse_notification_text",this._elements.notificationBodyText=document.createTextNode(""),this._elements.notificationBody.appendChild(this._elements.notificationBodyText),this._elements.anchor.appendChild(this._elements.notificationBody)}return a(c,b),c.prototype.className="Synapse.ServiceListItem",c.prototype.notifications=[],c.prototype._elements={},c.prototype._extractResponseObject=function(a){var b,c;return this.id=a.id,this.serviceName=a.service_name,this.category=a.category,this.displayName=a.display_name,a.dark_theme_icon&&(b=new Synapse.Image(this),b._extractResponseObject(a.dark_theme_icon),this.darkThemeIcon=b),a.light_theme_icon&&(b=new Synapse.Image(this),b._extractResponseObject(a.light_theme_icon),this.lightThemeIcon=b),a.link?(c=new Synapse.Link(this),c._extractResponseObject(a.link),c.serviceListItem=this,this.link=c):void 0},c.prototype._updateHTMLElement=function(){var a,b;return this._elements.categoryText.nodeValue=this.category,this._elements.serviceNameText.nodeValue=this.displayName,a="dark"===this._theme?this.darkThemeIcon:this.lightThemeIcon,a&&(this._elements.icon.src=a.src,this._elements.icon.width=a.width,this._elements.icon.height=a.height),b=this.notifications[0]&&this.notifications[0].link?this.notifications[0].link:this.link,this._elements.anchor.href=b.url,this._elements.anchor.target="_blank",this._elements.anchor.rel="nofollow",this._elements.anchor.addEventListener("click",function(a){return function(a){return a.preventDefault(),b.open(a)}}(this)),this.notifications.length>0?(this._elements.notificationBodyText.nodeValue=this.notifications[0].text,this._elements.notificationCountText.nodeValue=this.notifications.length):this._elements.notificationCountText.nodeValue=""},c.prototype.toHTMLElement=function(a){return null==a&&(a={}),this._theme=a.theme||"light",this._updateHTMLElement(),this._elements.container},c.prototype._bindToServiceNotification=function(a){return this._updateNotifications(a),a.addListener("update",function(b){return function(){return b._updateNotifications(a)}}(this))},c.prototype._updateNotifications=function(a){var b,c,d;return d=a.getNotificationItemsByServiceName(this.serviceName),b=this.notifications.map(function(a){return a.id}),c=d.map(function(a){return a.id}),b.sort().toString()!==c.sort().toString()&&(this.notifications=d,this.notifications.forEach(function(a){return function(b){return b.link?b.link.serviceListItem=a:void 0}}(this)),this._updateHTMLElement(),this.fire("notification_update")),b.length!==c.length?this.fire("notification_count_change"):void 0},c.prototype.trackShowEvent=function(){var a;return a={menu_name:this.serviceList.menu.menuName,service_list_item_id:this.id},this.notifications.length>0&&(a.service_notification_id=this.notifications[0].id),this.serviceList._isShowServiceItem(this.id)?void 0:(this.serviceList._setShowServiceItem(this.id),this.serviceList.menu._eventSender.send("show_service_list_item",a))},c.prototype.trackClickEvent=function(a){var b;return null==a&&(a={}),b={menu_name:this.serviceList.menu.menuName,service_list_item_id:this.id,is_deep_link:!!a.isDeepLink,is_deep_link_fallback:!!a.isDeepLinkFallback},a.nextUrl&&(b.next_url=a.nextUrl),a.urlSignature&&(b.url_signature=a.urlSignature),this.notifications.length>0&&(b.service_notification_id=this.notifications[0].id),this.serviceList.menu._eventSender.send("click_service_list_item",b,!!a.redirect)},c}(Synapse.MVCObject)}.call(this),function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;Synapse.ServiceNotification=function(b){function c(a){this.menu=a,this.status=Synapse.APIClient.prototype.STATE_INTIALIZED,this.serviceNotificationItems||(this.serviceNotificationItems=[])}return a(c,b),c.prototype.className="Synapse.ServiceNotification",c.prototype.fetch=function(){var a;return a=this.menu._apiClient.get("/api/v2/service_notifications.json",{menu_name:this.menu.menuName}),a.addListener("update",function(b){return function(){return b.status=Synapse.APIClient.prototype.STATE_LOADED,b._extractResponseObject(a.responseObject),b.fire("load"),b.fire("update")}}(this))},c.prototype._extractResponseObject=function(a){var b;return b=a.service_notifications,b?b.forEach(function(a){return function(b){var c;return c=new Synapse.ServiceNotificationItem(a),c._extractResponseObject(b),a.serviceNotificationItems.push(c)}}(this)):void 0},c.prototype.getNotificationItemsByServiceName=function(a){return this.serviceNotificationItems.filter(function(b){return b.serviceName===a})},c}(Synapse.MVCObject)}.call(this),function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;Synapse.ServiceNotificationItem=function(b){function c(a){this.service_notification=a}return a(c,b),c.prototype.className="Synapse.ServiceNotificationItem",c.prototype._extractResponseObject=function(a){var b;return this.id=a.id,this.serviceName=a.service_name,this.text=a.text,a.link?(b=new Synapse.Link(this),b._extractResponseObject(a.link),this.link=b):void 0},c}(Synapse.MVCObject)}.call(this),function(){Synapse.Navigation=function(){function a(){}return a.redirect=function(a,b){return null==b&&(b="_self"),document.location=a},a}()}.call(this),function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;Synapse.Image=function(b){function c(a){this.imageable=a}return a(c,b),c.prototype.className="Synapse.Image",c.prototype.src=null,c.prototype.width=null,c.prototype.height=null,c.prototype._extractResponseObject=function(a){return this.width=a.width,this.height=a.height,this.src=a.src},c}(Synapse.MVCObject)}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;Synapse.Link=function(c){function d(b){this.linkable=b,this._fallbackTimer=a(this._fallbackTimer,this),this._fallback=a(this._fallback,this)}return b(d,c),d.prototype.className="Synapse.Link",d.prototype.url=null,d.prototype.urlSignature=null,d.prototype.fallbackUrl=null,d.prototype.fallbackUrlSignature=null,d.prototype.androidPackageName=null,d.prototype.serviceListItem=null,d.prototype._extractResponseObject=function(a){return this.url=a.url,this.urlSignature=a.url_signature,this.fallbackUrl=a.fallback_url,this.fallbackUrlSignature=a.fallback_url_signature,this.androidPackageName=a.android_package_name},d.prototype.open=function(){var a,b;return b=this.url.match(/^(\w+)/)[1],"http"!==b&&"https"!==b?(this.serviceListItem.trackClickEvent({isDeepLink:!0,isDeepLinkFallback:!1,redirect:!1}),navigator.userAgent.indexOf("iPhone")>=0||navigator.userAgent.indexOf("iPad")>=0||navigator.userAgent.indexOf("iPod")>=0?navigator.userAgent.indexOf("CriOS")>=0?Synapse.Navigation.redirect(this.fallbackUrl):(a=document.createElement("iframe"),a.style.border="none",a.style.width="1px",a.style.height="1px",a.setAttribute("src",this.url),document.body.appendChild(a),this._fallbackTimer(2e3,a)):Synapse.Navigation.redirect(this.url)):this.serviceListItem.trackClickEvent({nextUrl:this.url,urlSignature:this.urlSignature,isDeepLink:!1,isDeepLinkFallback:!1,redirect:!0})},d.prototype._fallback=function(){return this.serviceListItem.trackClickEvent({nextUrl:this.fallbackUrl,urlSignature:this.fallbackUrlSignature,isDeepLink:!1,isDeepLinkFallback:!0,redirect:!0})()},d.prototype._fallbackTimer=function(a,b){var c;return c=Date.now(),setTimeout(function(d){return function(){var e;return document.body.appendChild(b),e=Date.now()-c-a,30>e?d._fallback():void 0}}(this),a)},d}(Synapse.MVCObject)}.call(this),function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;Synapse.EventSender=function(b){function c(a){this._apiClient=a}return a(c,b),c.prototype.send=function(a,b,c){var d,e,f,g;if(null==b&&(b={}),null==c&&(c=!1),d=c?"html":"json",f="/api/v2/events/"+a+"."+d,c){e=[];for(g in b)e.push(g+"="+encodeURIComponent(b[g]));return Synapse.Logger.debug("make redirection to: "+Synapse.endpoint+f+"?"+e.join("&")),Synapse.Navigation.redirect(""+Synapse.endpoint+f+"?"+e.join("&"))}return this._apiClient.get(f,b)},c}(Synapse.MVCObject)}.call(this),function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;Synapse.Page=function(b){function c(a){this.pageName=a,this._referenceId=Math.floor(1e8*Math.random()),this._eventSender=new Synapse.EventSender(new Synapse.APIClient)}return a(c,b),c.prototype.className="Synapse.Page",c.prototype.customParameters=["source","medium","campaign","term","content"],c.prototype.customParameterAttributes={},c.prototype.extractParametersFromLocation=function(a){var b;return b=a.search.split("?")[1],b?b.split("&").forEach(function(a){return function(b){var c,d,e;return c=b.split("="),d=c[0].match(/utm_(\w+)/),d&&(e=d[1],c[1]&&a.customParameters.indexOf(e)>=0)?a.customParameterAttributes[e]=decodeURIComponent(c[1]):void 0}}(this)):void 0},c.prototype.overrideParametersWithHTMLElement=function(a){return this.customParameters.forEach(function(b){return function(c){return a.dataset[c]?b.customParameterAttributes[c]=a.dataset[c]:void 0}}(this))},c.prototype.trackVisitEvent=function(){var a,b;a={page_name:this.pageName,http_referrer:document.referrer};for(b in this.customParameterAttributes)a["utm_"+b]=this.customParameterAttributes[b];return this._eventSender.send("visit_page",a)},c.initializeWithHTMLElement=function(a){var b;return a.dataset.endpoint&&(Synapse.endpoint=a.dataset.endpoint),a.dataset.logLevel&&(Synapse.Logger.logLevel=Synapse.Logger[a.dataset.logLevel]),a.dataset.pageName&&!a.dataset.referenceId?(b=new Synapse.Page(a.dataset.pageName),a.dataset._referenceId=b.referenceId,b.extractParametersFromLocation(location),b.overrideParametersWithHTMLElement(a),b.trackVisitEvent()):void 0},c}(Synapse.MVCObject)}.call(this);
//# sourceMappingURL=synapse.min.js.map