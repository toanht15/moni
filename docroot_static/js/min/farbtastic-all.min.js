jQuery(function(t){var e=t(".jsFarbtastic");for(i=0;i<e.length;i++){var o=t(e[i]).prev(".jsColorInput");t(e[i]).farbtastic(o)}t(".jsColorInput").focusin(function(){t(this).next(".jsFarbtastic").fadeIn(200)}),t(".jsColorInput").focusout(function(){t(this).next(".jsFarbtastic").fadeOut(200)})}),jQuery.fn.farbtastic=function(t){return $.farbtastic(this,t),this},jQuery.farbtastic=function(t,e){var t=$(t).get(0);return t.farbtastic||(t.farbtastic=new jQuery._farbtastic(t,e))},jQuery._farbtastic=function(t,e){var o=this;$(t).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var a=$(".farbtastic",t);o.wheel=$(".wheel",t).get(0),o.radius=84,o.square=100,o.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&$("*",a).each(function(){if("none"!=this.currentStyle.backgroundImage){var t=this.currentStyle.backgroundImage;t=this.currentStyle.backgroundImage.substring(5,t.length-2),$(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+t+"')"})}}),o.linkTo=function(t){return"object"==typeof o.callback&&$(o.callback).unbind("keyup",o.updateValue),o.color=null,"function"==typeof t?o.callback=t:("object"==typeof t||"string"==typeof t)&&(o.callback=$(t),o.callback.bind("keyup",o.updateValue),o.callback.get(0).value&&o.setColor(o.callback.get(0).value)),this},o.updateValue=function(){this.value&&this.value!=o.color&&o.setColor(this.value)},o.setColor=function(t){var e=o.unpack(t);return o.color!=t&&e&&(o.color=t,o.rgb=e,o.hsl=o.RGBToHSL(o.rgb),o.updateDisplay()),this},o.setHSL=function(t){return o.hsl=t,o.rgb=o.HSLToRGB(t),o.color=o.pack(o.rgb),o.updateDisplay(),this},o.widgetCoords=function(t){var e,a,r=t.target||t.srcElement,s=o.wheel;if("undefined"!=typeof t.offsetX){for(var n={x:t.offsetX,y:t.offsetY},u=r;u;)u.mouseX=n.x,u.mouseY=n.y,n.x+=u.offsetLeft,n.y+=u.offsetTop,u=u.offsetParent;for(var u=s,i={x:0,y:0};u;){if("undefined"!=typeof u.mouseX){e=u.mouseX-i.x,a=u.mouseY-i.y;break}i.x+=u.offsetLeft,i.y+=u.offsetTop,u=u.offsetParent}for(u=r;u;)u.mouseX=void 0,u.mouseY=void 0,u=u.offsetParent}else{var n=o.absolutePosition(s);e=(t.pageX||0*(t.clientX+$("html").get(0).scrollLeft))-n.x,a=(t.pageY||0*(t.clientY+$("html").get(0).scrollTop))-n.y}return{x:e-o.width/2,y:a-o.width/2}},o.mousedown=function(t){document.dragging||($(document).bind("mousemove",o.mousemove).bind("mouseup",o.mouseup),document.dragging=!0);var e=o.widgetCoords(t);return o.circleDrag=2*Math.max(Math.abs(e.x),Math.abs(e.y))>o.square,o.mousemove(t),!1},o.mousemove=function(t){var e=o.widgetCoords(t);if(o.circleDrag){var a=Math.atan2(e.x,-e.y)/6.28;0>a&&(a+=1),o.setHSL([a,o.hsl[1],o.hsl[2]])}else{var r=Math.max(0,Math.min(1,-(e.x/o.square)+.5)),s=Math.max(0,Math.min(1,-(e.y/o.square)+.5));o.setHSL([o.hsl[0],r,s])}return!1},o.mouseup=function(){$(document).unbind("mousemove",o.mousemove),$(document).unbind("mouseup",o.mouseup),document.dragging=!1},o.updateDisplay=function(){var t=6.28*o.hsl[0];$(".h-marker",a).css({left:Math.round(Math.sin(t)*o.radius+o.width/2)+"px",top:Math.round(-Math.cos(t)*o.radius+o.width/2)+"px"}),$(".sl-marker",a).css({left:Math.round(o.square*(.5-o.hsl[1])+o.width/2)+"px",top:Math.round(o.square*(.5-o.hsl[2])+o.width/2)+"px"}),$(".color",a).css("backgroundColor",o.pack(o.HSLToRGB([o.hsl[0],1,.5]))),"object"==typeof o.callback?($(o.callback).css({backgroundColor:o.color,color:o.hsl[2]>.5?"#000":"#fff"}),$(o.callback).each(function(){this.value&&this.value!=o.color&&(this.value=o.color)})):"function"==typeof o.callback&&o.callback.call(o,o.color)},o.absolutePosition=function(t){var e={x:t.offsetLeft,y:t.offsetTop};if(t.offsetParent){var a=o.absolutePosition(t.offsetParent);e.x+=a.x,e.y+=a.y}return e},o.pack=function(t){var e=Math.round(255*t[0]),o=Math.round(255*t[1]),a=Math.round(255*t[2]);return"#"+(16>e?"0":"")+e.toString(16)+(16>o?"0":"")+o.toString(16)+(16>a?"0":"")+a.toString(16)},o.unpack=function(t){return 7==t.length?[parseInt("0x"+t.substring(1,3))/255,parseInt("0x"+t.substring(3,5))/255,parseInt("0x"+t.substring(5,7))/255]:4==t.length?[parseInt("0x"+t.substring(1,2))/15,parseInt("0x"+t.substring(2,3))/15,parseInt("0x"+t.substring(3,4))/15]:void 0},o.HSLToRGB=function(t){var e,o,a=t[0],r=t[1],s=t[2];return o=.5>=s?s*(r+1):s+r-s*r,e=2*s-o,[this.hueToRGB(e,o,a+.33333),this.hueToRGB(e,o,a),this.hueToRGB(e,o,a-.33333)]},o.hueToRGB=function(t,e,o){return o=0>o?o+1:o>1?o-1:o,1>6*o?t+(e-t)*o*6:1>2*o?e:2>3*o?t+(e-t)*(.66666-o)*6:t},o.RGBToHSL=function(t){var e,o,a,r,s,n,u=t[0],i=t[1],c=t[2];return e=Math.min(u,Math.min(i,c)),o=Math.max(u,Math.max(i,c)),a=o-e,n=(e+o)/2,s=0,n>0&&1>n&&(s=a/(.5>n?2*n:2-2*n)),r=0,a>0&&(o==u&&o!=i&&(r+=(i-c)/a),o==i&&o!=c&&(r+=2+(c-u)/a),o==c&&o!=u&&(r+=4+(u-i)/a),r/=6),[r,s,n]},$("*",a).mousedown(o.mousedown),o.setColor("#000000"),e&&o.linkTo(e)};